mara = {"visualizations":[{"visualizations":[{"visualization":{"layout_diagram":{"type":"Flowchart","description":"A flowchart illustrating the components of the Indian Financial Year Budget, including Revenue Budget, Capital Budget, and Expenditure Budget. Each component is further divided into its sub-components, such as Tax Revenue and Non-Tax Revenue under Revenue Budget, and Capital Receipts and Payments under Capital Budget.","svg_code_snippet":"<svg width=\"500\" height=\"400\" xmlns=\"http://www.w3.org/2000/svg\">\n  <rect x=\"20\" y=\"20\" width=\"150\" height=\"30\" style=\"fill:lightblue;stroke:black;stroke-width:1\" />\n  <text x=\"25\" y=\"40\" font-family=\"Arial\" font-size=\"12\">Indian Financial Year Budget</text>\n  <line x1=\"95\" y1=\"50\" x2=\"95\" y2=\"80\" style=\"stroke:black;stroke-width:1\" />\n  <rect x=\"20\" y=\"80\" width=\"150\" height=\"30\" style=\"fill:lightgreen;stroke:black;stroke-width:1\" />\n  <text x=\"25\" y=\"100\" font-family=\"Arial\" font-size=\"12\">Revenue Budget</text>\n  <line x1=\"95\" y1=\"110\" x2=\"95\" y2=\"140\" style=\"stroke:black;stroke-width:1\" />\n  <rect x=\"20\" y=\"140\" width=\"150\" height=\"30\" style=\"fill:lightyellow;stroke:black;stroke-width:1\" />\n  <text x=\"25\" y=\"160\" font-family=\"Arial\" font-size=\"12\">Tax Revenue</text>\n  <rect x=\"20\" y=\"180\" width=\"150\" height=\"30\" style=\"fill:lightyellow;stroke:black;stroke-width:1\" />\n  <text x=\"25\" y=\"200\" font-family=\"Arial\" font-size=\"12\">Non-Tax Revenue</text>\n  <line x1=\"95\" y1=\"80\" x2=\"250\" y2=\"80\" style=\"stroke:black;stroke-width:1\" />\n  <rect x=\"250\" y=\"80\" width=\"150\" height=\"30\" style=\"fill:lightgreen;stroke:black;stroke-width:1\" />\n  <text x=\"255\" y=\"100\" font-family=\"Arial\" font-size=\"12\">Capital Budget</text>\n  <line x1=\"325\" y1=\"110\" x2=\"325\" y2=\"140\" style=\"stroke:black;stroke-width:1\" />\n  <rect x=\"250\" y=\"140\" width=\"150\" height=\"30\" style=\"fill:lightyellow;stroke:black;stroke-width:1\" />\n  <text x=\"255\" y=\"160\" font-family=\"Arial\" font-size=\"12\">Capital Receipts</text>\n  <rect x=\"250\" y=\"180\" width=\"150\" height=\"30\" style=\"fill:lightyellow;stroke:black;stroke-width:1\" />\n  <text x=\"255\" y=\"200\" font-family=\"Arial\" font-size=\"12\">Capital Payments</text>\n  <line x1=\"95\" y1=\"50\" x2=\"250\" y2=\"50\" style=\"stroke:black;stroke-width:1\" />\n  <rect x=\"250\" y=\"20\" width=\"150\" height=\"30\" style=\"fill:lightgreen;stroke:black;stroke-width:1\" />\n  <text x=\"255\" y=\"40\" font-family=\"Arial\" font-size=\"12\">Expenditure Budget</text>\n  <line x1=\"325\" y1=\"50\" x2=\"325\" y2=\"80\" style=\"stroke:black;stroke-width:1\" />\n</svg>","how_is_diagram_verified":"The diagram is verified by ensuring all components and sub-components of the Indian Financial Year Budget are accurately represented and connected logically.","how_are_overlaps_avoided":"Overlaps are avoided by clearly separating each component and sub-component with distinct lines and spacing."}},"visualization_type":"layout_diagram"}],"concept_from_textbook_chapter":"Components of the Indian Financial Year Budget","textbook_chapter_section_title":"Main Components of the Budget","is_concept_math_or_data_related":False},{"visualizations":[{"visualization":{"image":{"prompt":"A simple image showing the Indian Finance Minister presenting the Union Budget in the Parliament, with a backdrop of the Indian national flag and a large screen displaying budget figures."}},"visualization_type":"image"}],"concept_from_textbook_chapter":"Significance of the Indian Financial Year Budget","textbook_chapter_section_title":"Purpose of the Budget","is_concept_math_or_data_related":False}]}
mioo_res ="# Chapter: The Indian Financial Year Budget\n\n## Introduction to the Indian Financial Year Budget\n\nThe Indian financial year spans from April 1st to March 31st of the following year. The Union Budget, presented annually by the Finance Minister, is a comprehensive financial statement that outlines the government's expected revenue and expenditure for the upcoming financial year. It serves as a crucial tool for economic planning and policy formulation, reflecting the government's fiscal policy and priorities.\n\n### Purpose of the Budget\n\nThe primary purpose of the budget is to allocate resources efficiently, manage public finances, and stimulate economic growth. It provides a framework for the government to plan its expenditure, manage its income, and ensure fiscal discipline. The budget also aims to address socio-economic challenges, promote equitable growth, and enhance the quality of life for citizens.\n\n### Main Components of the Budget\n\nThe budget is divided into several components, primarily the Revenue Budget, Capital Budget, and Expenditure Budget. Each component plays a distinct role in the financial planning and management of the country.\n\n## Revenue Budget\n\n### Definition of Revenue Budget\n\nThe Revenue Budget consists of the government's revenue receipts and expenditure. It is a critical component that reflects the government's ability to generate income to fund its operational expenses without resorting to borrowing.\n\n### Revenue Receipts\n\nRevenue receipts are bifurcated into two categories:\n- **Tax Revenue**: This includes income tax, corporate tax, Goods and Services Tax (GST), and customs duties.\n- **Non-Tax Revenue**: This comprises interest, dividends, and fees collected by the government.\n\n### Significance of the Revenue Budget\n\nThe Revenue Budget is significant as it provides insights into the fiscal health of the government and its capacity to manage public services and infrastructure development. A well-balanced Revenue Budget indicates efficient tax collection and prudent financial management, essential for sustainable economic growth.\n\n## Capital Budget\n\n### Definition of Capital Budget\n\nThe Capital Budget includes capital receipts and payments, focusing on the government's investment in assets. It is crucial for financing capital expenditure and creating physical assets and infrastructure.\n\n### Capital Receipts and Payments\n\n- **Capital Receipts**: These include loans raised by the government, disinvestment proceeds, and recovery of loans.\n- **Capital Payments**: These involve expenditure on acquiring assets like land, buildings, machinery, and investments in infrastructure projects.\n\n### Role of the Capital Budget in Economic Growth\n\nThe Capital Budget plays a crucial role in economic growth by facilitating the creation of physical assets and infrastructure, which are essential for enhancing productivity and competitiveness. It reflects the government's commitment to long-term development goals and its strategy for managing public debt and investments.\n\n## Expenditure Budget\n\n### Definition of Expenditure Budget\n\nThe Expenditure Budget outlines the allocation of funds across various sectors and ministries. It is a comprehensive outline of the government's spending plans.\n\n### Plan and Non-Plan Expenditure\n\n- **Plan Expenditure**: This refers to spending on government schemes and development programs aimed at economic growth and social welfare.\n- **Non-Plan Expenditure**: This includes routine expenses such as salaries, pensions, interest payments, and subsidies.\n\n### Importance of the Expenditure Budget\n\nThe Expenditure Budget is vital for ensuring the efficient allocation of resources, enabling the government to achieve its policy objectives and development goals. It reflects the government's priorities and its commitment to addressing socio-economic challenges. A well-planned Expenditure Budget can enhance public service delivery and improve the quality of life for citizens.\n\n## Conclusion\n\nThe Indian financial year budget is a comprehensive financial plan that plays a pivotal role in the country's economic management. By understanding its components—Revenue Budget, Capital Budget, and Expenditure Budget—one can gain insights into the government's fiscal policy, priorities, and its impact on the economy. The budget not only guides economic planning but also serves as a tool for achieving sustainable growth and development."
def create_book_with_visualizations():
    """
    Create a book-like structure with content from mioo_res and 
    visualizations from mara placed appropriately
    """
    # Extract visualizations from mara with debugging
    section_viz_map = {}
    
    print("Available visualizations:")
    for viz_group in mara["visualizations"]:
        section_title = viz_group["textbook_chapter_section_title"]
        concept = viz_group["concept_from_textbook_chapter"]
        
        print(f"- Found visualization for concept: '{concept}' in section: '{section_title}'")
        
        if section_title not in section_viz_map:
            section_viz_map[section_title] = []
        
        viz_entry = {
            "concept": concept,
            "type": None,
            "content": None,
            "description": None
        }
        
        # Get the specific visualization data
        if viz_group["visualizations"] and "visualization" in viz_group["visualizations"][0]:
            viz = viz_group["visualizations"][0]["visualization"]
            
            # Check for SVG diagrams
            if "mathematical_diagram" in viz and "svg_code_snippet" in viz["mathematical_diagram"]:
                viz_entry["type"] = "svg"
                viz_entry["content"] = viz["mathematical_diagram"]["svg_code_snippet"]
                viz_entry["description"] = viz["mathematical_diagram"]["description"]
                print(f"  - Found SVG for '{concept}'")
            
            # Check for images
            elif "image" in viz and "prompt" in viz["image"]:
                viz_entry["type"] = "image"
                viz_entry["content"] = viz["image"]["prompt"]
                print(f"  - Found image prompt for '{concept}'")
        
        section_viz_map[section_title].append(viz_entry)
    
    # Create HTML with proper MathJax support for LaTeX
    html_content = [
        "<!DOCTYPE html>",
        "<html>",
        "<head>",
        "    <title>The Pythagorean Theorem</title>",
        "    <script src='https://polyfill.io/v3/polyfill.min.js?features=es6'></script>",
        "    <script id='MathJax-script' async src='https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'></script>",
        "    <style>",
        "        body { font-family: Arial, sans-serif; line-height: 1.6; margin: 40px; max-width: 800px; margin: 0 auto; }",
        "        h1 { color: #333; }",
        "        h2 { color: #555; border-bottom: 1px solid #ddd; padding-bottom: 5px; margin-top: 30px; }",
        "        h3 { color: #666; margin-top: 20px; }",
        "        .visualization { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background-color: #f9f9f9; }",
        "        .viz-title { font-weight: bold; margin-bottom: 10px; color: #444; }",
        "        .viz-description { font-style: italic; margin-bottom: 15px; color: #666; }",
        "        .svg-container { text-align: center; margin: 20px 0; }",
        "        .img-placeholder { text-align: center; padding: 20px; background-color: #eee; border-radius: 5px; }",
        "        .formula { font-style: italic; color: #333; margin: 15px 0; }",
        "    </style>",
        "</head>",
        "<body>"
    ]
    
    # Parse mioo_res content and add visualizations
    lines = mioo_res.split('\n')
    current_section = None
    
    i = 0
    while i < len(lines):
        line = lines[i]
        
        # Process headers
        if line.startswith('# '):
            html_content.append(f"<h1>{line[2:]}</h1>")
        elif line.startswith('## '):
            section_name = line[3:]
            current_section = section_name
            html_content.append(f"<h2>{section_name}</h2>")
        elif line.startswith('### '):
            concept_name = line[4:]
            html_content.append(f"<h3>{concept_name}</h3>")
            
            # Check if there's a visualization for this concept in the current section
            if current_section and current_section in section_viz_map:
                for viz in section_viz_map[current_section]:
                    if viz["concept"] == concept_name:
                        html_content.append("<div class='visualization'>")
                        html_content.append(f"<div class='viz-title'>Visualization: {concept_name}</div>")
                        
                        if viz["type"] == "svg":
                            if viz["description"]:
                                html_content.append(f"<div class='viz-description'>{viz['description']}</div>")
                            
                            # Insert SVG directly - using triple quotes to avoid escaping issues
                            html_content.append("<div class='svg-container'>")
                            html_content.append(viz["content"])
                            html_content.append("</div>")
                        
                        elif viz["type"] == "image":
                            html_content.append("<div class='img-placeholder'>")
                            html_content.append("<p>Image based on prompt:</p>")
                            html_content.append(f"<p><em>{viz['content']}</em></p>")
                            html_content.append("</div>")
                        
                        html_content.append("</div>")
        
        # Process LaTeX
        elif line.startswith('\\[') and '\\]' in line:
            # MathJax will handle the LaTeX - just add it directly
            html_content.append(f"<div class='formula'>{line}</div>")
        elif '\\(' in line and '\\)' in line:
            # Inline LaTeX - needs to be properly wrapped for MathJax
            html_content.append(f"<p>{line}</p>")
        # Regular paragraph
        elif line.strip() == '':
            html_content.append("<br>")
        else:
            html_content.append(f"<p>{line}</p>")
        
        i += 1
    
    html_content.append("</body>")
    html_content.append("</html>")
    
    return "\n".join(html_content)

# Generate the book content as HTML
html_book_content = create_book_with_visualizations()
with open('book_with_visualizations2.html', 'w') as f:
    f.write(html_book_content)
print("HTML book with SVG visualizations has been created as 'book_with_visualizations.html'")